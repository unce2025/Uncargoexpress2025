<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Admin Panel - United Nation Cargo Express</title>
  <style>
    :root {
      --primary: #001f3f;
      --light: #ffffff;
      --gray: #f5f5f5;
      --border: #ccc;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--gray);
      color: #000;
    }

    header {
      background: var(--primary);
      color: var(--light);
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
    }

    .container {
      padding: 1rem;
      max-width: 1000px;
      margin: auto;
    }

    .section {
      background: var(--light);
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
    }

    .section h2 {
      margin-top: 0;
      color: var(--primary);
    }

    label {
      display: block;
      margin: 0.5rem 0 0.2rem;
    }

    input, select, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 1rem;
    }

    textarea {
      height: 100px;
      resize: vertical;
    }

    button {
      background: var(--primary);
      color: var(--light);
      padding: 0.6rem 1.5rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }

    button:hover {
      opacity: 0.9;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .col {
      flex: 1;
      min-width: 280px;
    }

    @media (max-width: 600px) {
      input, select, textarea {
        font-size: 1rem;
      }
    }

    .subsection {
      margin-bottom: 1rem;
    }

    .history-entry {
      border: 1px solid var(--border);
      padding: 0.5rem;
      border-radius: 4px;
      margin-bottom: 0.5rem;
      background: #f9f9f9;
    }
  </style>
</head>
<body>
  <header>Admin Panel - United Nation Cargo Express</header>

  <div class="container">
    <!-- Search Section -->
    <div class="section">
      <h2>Search Shipment</h2>
      <form id="searchForm" onsubmit="event.preventDefault(); loadShipment();">
        <label for="TrackingNumber">Tracking Number</label>
        <input type="text" id="TrackingNumber" required />
        <button type="submit">Search</button>
      </form>
    </div>

    <!-- Shipment Form Section -->
    <div class="section">
      <h2>Shipment Details</h2>
      <div class="row">
        <div class="col">
          <label for="Status">Status</label>
          <input type="text" id="Status" />

          <label for="ShipperName">Shipper Name</label>
          <input type="text" id="ShipperName" />

          <label for="ShipperPhone">Shipper Phone</label>
          <input type="text" id="ShipperPhone" />

          <label for="ShipperAddress">Shipper Address</label>
          <input type="text" id="ShipperAddress" />

          <label for="ShipperEmail">Shipper Email</label>
          <input type="email" id="ShipperEmail" />

          <label for="EstimatedDeliveryDate">Estimated Delivery Date</label>
          <input type="date" id="EstimatedDeliveryDate" />

          <label for="ShippedDate">Shipped Date</label>
          <input type="date" id="ShippedDate" />
        </div>

        <div class="col">
          <label for="ReceiverName">Receiver Name</label>
          <input type="text" id="ReceiverName" />

          <label for="ReceiverPhone">Receiver Phone</label>
          <input type="text" id="ReceiverPhone" />

          <label for="ReceiverAddress">Receiver Address</label>
          <input type="text" id="ReceiverAddress" />

          <label for="ReceiverEmail">Receiver Email</label>
          <input type="email" id="ReceiverEmail" />

          <label for="FlightNumber">Flight Number</label>
          <input type="text" id="FlightNumber" />

          <label for="PackageWeight">Package Weight (kg)</label>
          <input type="text" id="PackageWeight" />

          <label for="PickUpTime">Pick Up Time</label>
          <input type="text" id="PickUpTime" />
        </div>
      </div>

      <label for="Departure">Departure</label>
      <input type="text" id="Departure" />

      <label for="Mode">Mode</label>
      <input type="text" id="Mode" />

      <label for="Product">Product</label>
      <input type="text" id="Product" />

      <label for="Quantity">Quantity</label>
      <input type="text" id="Quantity" />

      <label for="Payment">Payment</label>
      <input type="text" id="Payment" />

      <label for="TotalFreight">Total Freight</label>
      <input type="text" id="TotalFreight" />

      <label for="logDate">Log Date</label>
      <input type="date" id="logDate" />

      <label for="logDescription">Log Description</label>
      <input type="text" id="logDescription" />

      <button type="button" onclick="addLogEntry()">Add Log Entry</button>

      <label for="log">Log</label>
      <textarea id="log" readonly></textarea>
    </div>

    <!-- Shipment History Section -->
    <div class="section">
      <h2>Shipment History</h2>

      <div class="row">
        <div class="col">
          <label for="historyDate">Date</label>
          <input type="date" id="historyDate" />

          <label for="historyTime">Time</label>
          <input type="time" id="historyTime" />

          <label for="historyLocation">Location</label>
          <input type="text" id="historyLocation" />
        </div>

        <div class="col">
          <label for="historyStatus">Status</label>
          <input type="text" id="historyStatus" />

          <label for="historyUpdatedBy">Updated By</label>
          <input type="text" id="historyUpdatedBy" />

          <label for="historyRemarks">Remarks</label>
          <input type="text" id="historyRemarks" />
        </div>
      </div>

      <button type="button" onclick="addHistoryEntry()">Add History Entry</button>

      <div id="historyContainer"></div>
    </div>

    <div style="text-align:center; margin-bottom: 2rem;">
      <button type="button" onclick="saveShipment()">Save Shipment</button>
    </div>
  </div>

  <script>
    const endpoint = 'https://script.google.com/macros/s/AKfycbxaJNPDvBfowAq9OUojrSm4zi2l1HcUUbYKkJprfeOZUfvIDRjYuiCKK4j2ShANdOxK/exec'; // Replace with your Apps Script URL
    let history = [];

    function getValue(id) {
      return document.getElementById(id).value.trim();
    }

    function setValue(id, value) {
      document.getElementById(id).value = value || '';
    }

    function addLogEntry() {
      const date = getValue('logDate');
      const desc = getValue('logDescription');
      if (date && desc) {
        const currentLog = getValue('log');
        setValue('log', `${currentLog}${date}: ${desc}\n`);
        setValue('logDate', '');
        setValue('logDescription', '');
      } else {
        alert("Please enter both Log Date and Description.");
      }
    }

    function addHistoryEntry() {
      const entry = {
        Date: getValue('historyDate'),
        Time: getValue('historyTime'),
        Location: getValue('historyLocation'),
        Status: getValue('historyStatus'),
        UpdatedBy: getValue('historyUpdatedBy'),
        Remarks: getValue('historyRemarks')
      };

      if (!entry.Date || !entry.Time || !entry.Location || !entry.Status) {
        alert("Please fill in at least Date, Time, Location and Status for History Entry.");
return;
}
        history.push(entry);
  displayHistory();
  clearHistoryInputs();
}

function clearHistoryInputs() {
  setValue('historyDate', '');
  setValue('historyTime', '');
  setValue('historyLocation', '');
  setValue('historyStatus', '');
  setValue('historyUpdatedBy', '');
  setValue('historyRemarks', '');
}

function displayHistory() {
  const container = document.getElementById('historyContainer');
  container.innerHTML = '';
  if (history.length === 0) {
    container.innerHTML = '<p>No history entries.</p>';
    return;
  }
  history.forEach((entry, index) => {
    const div = document.createElement('div');
    div.classList.add('history-entry');
    div.innerHTML = `
      <strong>Entry ${index + 1}</strong><br/>
      Date: ${entry.Date} Time: ${entry.Time}<br/>
      Location: ${entry.Location}<br/>
      Status: ${entry.Status}<br/>
      Updated By: ${entry.UpdatedBy || '-'}<br/>
      Remarks: ${entry.Remarks || '-'}<br/>
      <button onclick="removeHistoryEntry(${index})">Remove</button>
    `;
    container.appendChild(div);
  });
}

function removeHistoryEntry(index) {
  history.splice(index, 1);
  displayHistory();
}

function saveShipment() {
  const shipment = {
    TrackingNumber: getValue('TrackingNumber'),
    Status: getValue('Status'),
    ShipperName: getValue('ShipperName'),
    ShipperPhone: getValue('ShipperPhone'),
    ShipperAddress: getValue('ShipperAddress'),
    ShipperEmail: getValue('ShipperEmail'),
    ReceiverName: getValue('ReceiverName'),
    ReceiverPhone: getValue('ReceiverPhone'),
    ReceiverAddress: getValue('ReceiverAddress'),
    ReceiverEmail: getValue('ReceiverEmail'),
    EstimatedDeliveryDate: getValue('EstimatedDeliveryDate'),
    ShippedDate: getValue('ShippedDate'),
    PickUpTime: getValue('PickUpTime'),
    FlightNumber: getValue('FlightNumber'),
    PackageWeight: getValue('PackageWeight'),
    Departure: getValue('Departure'),
    Mode: getValue('Mode'),
    Product: getValue('Product'),
    Quantity: getValue('Quantity'),
    Payment: getValue('Payment'),
    TotalFreight: getValue('TotalFreight'),
    log: getValue('log'),
    history: JSON.stringify(history),
  };

  if (!shipment.TrackingNumber) {
    alert('Tracking Number is required');
    return;
  }

  fetch(endpoint, {
    method: 'POST',
    mode: 'cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(shipment)
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert('Shipment saved successfully!');
    } else {
      alert('Error saving shipment.');
      console.error(data);
    }
  })
  .catch(err => {
    console.error(err);
    alert('Failed to save shipment.');
  });
}

function clearForm() {
  const inputs = document.querySelectorAll('input, textarea');
  inputs.forEach(input => input.value = '');
  history = [];
  displayHistory();
}

function loadShipment() {
  clearForm();
  const tracking = getValue('TrackingNumber');
  if (!tracking) {
    alert("Please enter a Tracking Number.");
    return;
  }
  fetch(`${endpoint}?tracking=${encodeURIComponent(tracking)}`)
    .then(res => res.json())
    .then(data => {
      if (data.success && data.shipment) {
        const s = data.shipment;
        setValue('Status', s.Status);
        setValue('ShipperName', s.ShipperName);
        setValue('ShipperPhone', s.ShipperPhone);
        setValue('ShipperAddress', s.ShipperAddress);
        setValue('ShipperEmail', s.ShipperEmail);
        setValue('ReceiverName', s.ReceiverName);
        setValue('ReceiverPhone', s.ReceiverPhone);
        setValue('ReceiverAddress', s.ReceiverAddress);
        setValue('ReceiverEmail', s.ReceiverEmail);
        setValue('EstimatedDeliveryDate', s.EstimatedDeliveryDate);
        setValue('ShippedDate', s.ShippedDate);
        setValue('PickUpTime', s.PickUpTime);
        setValue('FlightNumber', s.FlightNumber);
        setValue('PackageWeight', s.PackageWeight);
        setValue('Departure', s.Departure);
        setValue('Mode', s.Mode);
        setValue('Product', s.Product);
        setValue('Quantity', s.Quantity);
        setValue('Payment', s.Payment);
        setValue('TotalFreight', s.TotalFreight);
        setValue('log', s.log);

        history = [];
        if (s.history) {
          try {
            history = JSON.parse(s.history);
            if (!Array.isArray(history)) history = [];
          } catch (e) {
            console.error("Error parsing history", e);
          }
        }
        displayHistory();
      } else {
        alert("Shipment not found.");
      }
    })
    .catch(err => {
      console.error(err);
      alert("Failed to fetch shipment.");
    });
}
</script> </body> </html>
